---
title: "Covid-Chile"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    css: www/style.css
    favicon: www/favicon.png    
    social: ["twitter", "facebook", "linkedin"]
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(lubridate)
library(highcharter)
library(RcppRoll)

source("R/00-parametros.R", encoding = "UTF-8")
source("R/01-productos.R", encoding = "UTF-8")
source("R/02-graficos-tablas.R", encoding = "UTF-8")
source("R/03-funciones-auxiliares.R", encoding = "UTF-8")
source("R/04-value-boxes.R", encoding = "UTF-8")
```

Inicio {data-icon="fa-tachometer-alt"}
=====================================  

Row {data-height=250}
-----------------------------------------------------------------------

### 

```{r}
value <- vb_confirmados() %>% filter(tipo == "total") %>% pull(descripcion)
caption <- "Confirmados"
info <- vb_confirmados() %>% filter(tipo != "total") %>% pull(descripcion)

valueBoxCaptions(value, caption, info)

```

### 

```{r}
valueBox("31.234", caption = "Fallecidos", icon = NULL, color = NULL, href = NULL)
```

### 

```{r}
valueBox("65%", caption = "Vacunación", icon = NULL, color = NULL, href = NULL)
```

### 

```{r}
valueBox("3.230", caption = "UCI", icon = NULL, color = NULL, href = NULL)
```


Row 
-----------------------------------------------------------------------

###

```{r}
grafico_confirmados_diarios()
```

###

```{r}
grafico_defunciones_diarias()
```

###

```{r}
grafico_porcentaje_vacunacion_edad()
```

Row 
-----------------------------------------------------------------------

### 

```{r}
```

### 

```{r}
```

###

```{r}
grafico_pacientes_uci()
```


Vacunación {data-icon="fa-syringe"}
=====================================  

Row 
-----------------------------------------------------------------------

### 

```{r}
grafico_porcentaje_vacunacion_edad()
```

### 

```{r}
grafico_porcentaje_vacunacion_edad_fecha()
```

Row 
-----------------------------------------------------------------------

### 

```{r}
```

### 

```{r}
```

<!-- `r fontawesome::fa("route")` Movilidad -->
<!-- =====================================   -->

<!-- Row  -->
<!-- ----------------------------------------------------------------------- -->

<!-- ###  -->

<!-- ```{r} -->
<!-- ``` -->


Mortalidad {data-icon="fa-ribbon"}
=====================================  

Row 
-----------------------------------------------------------------------

### 

```{r}
grafico_defunciones_diarias()
```

### 

```{r}
grafico_letalidad()
```

Row 
-----------------------------------------------------------------------

### 

```{r}
grafico_defunciones_esperadas_arima()
```

### 

```{r}
grafico_defunciones_semanales_pandemia()
```

Region {data-icon="fa-map-marked-alt"}
=====================================  

Row {data-height=800}
-----------------------------------------------------------------------

### 

```{r}
tabla_region()
```

Row
-----------------------------------------------------------------------

### 

```{r}
grafico_defunciones_por_region_100k_hab()
```

### 

```{r}
grafico_activos_media_movil_7_dias_por_region_100k_hab()
```

### 

```{r}
```

### 

<script>
PARS = `r jsonlite::toJSON(PARS)`
</script>

```{js}
document.addEventListener('DOMContentLoaded', function() {
  
  var table = $('#DataTables_Table_0').DataTable()
  
  var hc_falle = $('#hc_fallecimientos_region').highcharts();
  
  var hc_act7m = $('#hc_activos_media_movil_7_dias_region').highcharts();
  
  $('#tabla_region tbody').on('mouseover', 'tr', function () {
  
    var d = table.row( this ).data();
    
    console.log(d);
    
    var idn = d[1]
    
    for (var i = 0; i <= (16 - 1); i++) {
      hc_falle.series[i].update({color: PARS.colors.gray[0], lineWidth: 1, zIndex: 0});
      hc_act7m.series[i].update({color: PARS.colors.gray[0], lineWidth: 1, zIndex: 0});
    }
    
    hc_falle.get(idn).update({color: PARS.colors.primary[0], lineWidth: 4, zIndex: 1});
    hc_act7m.get(idn).update({color: PARS.colors.primary[0], lineWidth: 4, zIndex: 1});
    
  });
    
}, false);
```





Acerca {data-icon="fa-question-circle"}
=====================================  

Row {data-height=500}
-----------------------------------------------------------------------

### 

```{r}
```